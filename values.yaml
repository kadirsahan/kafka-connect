# Default values for kafka-connect
# This is a YAML-formatted file.

# Cluster name and namespace
nameOverride: "debezium-oracle-connect"
namespace: "kraft-kafka-connect"

# Kafka Connect configuration
kafkaConnect:
  # Number of replicas
  replicas: 2

  # Custom image with Debezium connectors
  image: "kadirsahan/kafka-connect-strimzi-build:1.4"

  # Bootstrap servers - Kafka cluster connection (TLS port)
  bootstrapServers: "kraft-kafka-cluster-kafka-bootstrap.kraft-kafka.svc.cluster.local:9093"

  # Enable connector resources (CRD-based connector management)
  useConnectorResources: true

  # TLS configuration
  tls:
    enabled: true
    # Cluster CA certificate secret (auto-generated by Strimzi in Kafka namespace)
    # NOTE: This secret needs to be copied from kraft-kafka namespace to kraft-kafka-connect namespace
    # kubectl get secret kraft-kafka-cluster-cluster-ca-cert -n kraft-kafka -o yaml | \
    #   sed 's/namespace: kraft-kafka/namespace: kraft-kafka-connect/' | kubectl apply -f -
    clusterCaSecret: "kraft-kafka-cluster-cluster-ca-cert"
    clusterCaCertificate: "ca.crt"
    # Kafka cluster namespace (where the CA secret is located)
    kafkaNamespace: "kraft-kafka"

  # mTLS Authentication configuration
  authentication:
    enabled: true
    type: "tls"  # mTLS authentication
    # User certificate secret (auto-generated by KafkaUser CR)
    userSecret: "kafka-connect-user"
    userCertificate: "user.crt"
    userKey: "user.key"

  # Kafka Connect configuration
  config:
    groupId: "connect-cluster"
    offsetStorageTopic: "connect-cluster-offsets"
    configStorageTopic: "connect-cluster-configs"
    statusStorageTopic: "connect-cluster-status"
    keyConverter: "org.apache.kafka.connect.json.JsonConverter"
    valueConverter: "org.apache.kafka.connect.json.JsonConverter"
    keySchemasEnable: true
    valueSchemasEnable: true
    configStorageReplicationFactor: 1
    offsetStorageReplicationFactor: 1
    statusStorageReplicationFactor: 1

  # Resource limits and requests
  resources:
    requests:
      memory: "512Mi"
      cpu: "300m"
    limits:
      memory: "2Gi"
      cpu: "1000m"

# Kafka Users (for mTLS authentication)
kafkaUsers:
  - name: "kafka-connect-user"
    enabled: true
    kafkaCluster: "kraft-kafka-cluster"  # Name of the Kafka cluster
    authentication: "tls"  # mTLS authentication
    authorization:
      enabled: true
      type: "simple"
      acls:
        # Allow reading from consumer group
        - resource:
            type: "group"
            name: "connect-cluster"
            patternType: "prefix"
          operations:
            - "Read"
        # Allow access to connect internal topics
        - resource:
            type: "topic"
            name: "connect-cluster-"
            patternType: "prefix"
          operations:
            - "Read"
            - "Write"
            - "Create"
            - "Describe"
        # Allow access to offset storage topic
        - resource:
            type: "topic"
            name: "connect-cluster-offsets"
            patternType: "literal"
          operations:
            - "Read"
            - "Write"
            - "Create"
            - "Describe"
        # Allow access to config storage topic
        - resource:
            type: "topic"
            name: "connect-cluster-configs"
            patternType: "literal"
          operations:
            - "Read"
            - "Write"
            - "Create"
            - "Describe"
        # Allow access to status storage topic
        - resource:
            type: "topic"
            name: "connect-cluster-status"
            patternType: "literal"
          operations:
            - "Read"
            - "Write"
            - "Create"
            - "Describe"
        # Allow access to any topics for connectors (adjust as needed)
        - resource:
            type: "topic"
            name: "*"
            patternType: "literal"
          operations:
            - "Read"
            - "Write"
            - "Create"
            - "Describe"
        # Allow cluster operations
        - resource:
            type: "cluster"
            patternType: "literal"
          operations:
            - "Create"
            - "Describe"

# PostgreSQL credentials secret
postgresSecret:
  # Enable creation of postgres-credentials secret
  enabled: true
  name: "postgres-credentials"
  # Base64 encoded password
  # To encode: echo -n 'yourpassword' | base64
  password: "NlpJUEpBRTdrMDdWTG9iR2J4cXh5eXZVb3kyTWFXTTdYdG9sVm5zWE40bWNmRFRQNjRCUnlkUmF6S01VN3paRQ=="
